class ABCarousel{constructor(t){t&&(this.carousel=t,this.config={slidesToShow:parseFloat(t.dataset.slides)||1,responsive:t.dataset.responsive?JSON.parse(t.dataset.responsive):null,gap:void 0!==t.dataset.gap?parseInt(t.dataset.gap):20,autoPlay:"true"===t.dataset.autoplay,duration:parseInt(t.dataset.duration)||3e3,centerMode:"true"===t.dataset.center,loop:"false"!==t.dataset.loop},this.state={currentIndex:0,isDragging:!1,startPos:0,currentTranslate:0,prevTranslate:0,isTransitioning:!1,autoPlayInterval:null,isVisible:!1,animationID:null},this.setupDOM(),this.init())}setupDOM(){const t=Array.from(this.carousel.children).filter(t=>!t.classList.contains("ab-carousel-nav")&&!t.classList.contains("ab-carousel-dots")&&!t.classList.contains("ab-carousel-container"));if(t.length>0&&!this.carousel.querySelector(".ab-carousel-track")){const e=document.createElement("div");e.className="ab-carousel-container";const s=document.createElement("div");s.className="ab-carousel-track",e.appendChild(s),t.forEach(t=>{const e=document.createElement("div");e.className="ab-carousel-item",e.appendChild(t),s.appendChild(e)}),this.carousel.prepend(e)}this.track=this.carousel.querySelector(".ab-carousel-track"),this.originalItems=Array.from(this.track.children),this.setupNavigation(),this.carousel.querySelectorAll("img").forEach(t=>t.setAttribute("draggable","false"))}setupNavigation(){const t=this.carousel.dataset;if(this.carousel.querySelector(".ab-carousel-nav")||"false"===t.nav)this.prevBtn=t.navPrev?document.querySelector(t.navPrev):this.carousel.querySelector(".ab-carousel-nav.prev"),this.nextBtn=t.navNext?document.querySelector(t.navNext):this.carousel.querySelector(".ab-carousel-nav.next");else{const t=(t,e)=>{const s=document.createElement("button");return s.className=`ab-carousel-nav ${t}`,s.innerHTML=`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="${e}"></polyline></svg>`,this.carousel.appendChild(s),s};this.prevBtn=t("prev","15 18 9 12 15 6"),this.nextBtn=t("next","9 18 15 12 9 6")}this.dotsContainer=t.dotsContainer?document.querySelector(t.dotsContainer):this.carousel.querySelector(".ab-carousel-dots"),this.dotsContainer||"false"===t.dots||(this.dotsContainer=document.createElement("div"),this.dotsContainer.className="ab-carousel-dots",this.carousel.appendChild(this.dotsContainer))}init(){this.config.loop&&(this.cloneItems(),this.state.currentIndex=this.originalItems.length),this.updateSlidesCount(),this.createDots(),this.addEventListeners(),this.updateCarousel(!1),this.setupIntersectionObserver(),this.resizeObserver=new ResizeObserver(()=>{this.updateSlidesCount(),this.updateCarousel(!1),this.updateHeight()}),this.resizeObserver.observe(this.carousel)}cloneItems(){const t=this.originalItems.map(t=>t.cloneNode(!0)),e=this.originalItems.map(t=>t.cloneNode(!0));t.forEach(t=>{t.classList.add("ab-clone"),this.track.appendChild(t)}),e.reverse().forEach(t=>{t.classList.add("ab-clone"),this.track.insertBefore(t,this.track.firstChild)}),this.items=Array.from(this.track.children)}updateSlidesCount(){const t=window.innerWidth;let e=this.config.slidesToShow;if(this.config.responsive){const s=Object.keys(this.config.responsive).map(Number).sort((t,e)=>e-t);for(let i of s)t<=i&&(e=this.config.responsive[i])}this.currentSlidesToShow=e,this.items=Array.from(this.track.children);const s=100/e;this.items.forEach(t=>{t.style.flex=`0 0 ${s}%`,t.style.padding=`0 ${this.config.gap/2}px`})}createDots(){if(!this.dotsContainer)return;this.dotsContainer.innerHTML="";const t=this.originalItems.length;if(t<=1)return;const e=document.createDocumentFragment();for(let s=0;s<t;s++){const t=document.createElement("button");t.className="ab-carousel-dot",t.onclick=()=>this.goTo(this.config.loop?s+this.originalItems.length:s),e.appendChild(t)}this.dotsContainer.appendChild(e)}addEventListeners(){this.nextBtn?.addEventListener("click",()=>this.next()),this.prevBtn?.addEventListener("click",()=>this.prev());const t=()=>this.stopAutoPlay(),e=()=>this.handleAutoPlay();this.carousel.addEventListener("mouseenter",t),this.carousel.addEventListener("mouseleave",e),this.carousel.addEventListener("touchstart",t,{passive:!0}),this.carousel.addEventListener("touchend",e,{passive:!0}),this.track.addEventListener("mousedown",t=>this.dragStart(t)),window.addEventListener("mousemove",t=>this.dragAction(t)),window.addEventListener("mouseup",()=>this.dragEnd()),this.track.addEventListener("touchstart",t=>this.dragStart(t),{passive:!0}),window.addEventListener("touchmove",t=>this.dragAction(t),{passive:!1}),window.addEventListener("touchend",()=>this.dragEnd()),this.track.addEventListener("transitionend",()=>this.handleTransitionEnd())}setupIntersectionObserver(){new IntersectionObserver(([t])=>{this.state.isVisible=t.isIntersecting,this.handleAutoPlay()},{threshold:.1}).observe(this.carousel)}handleTransitionEnd(){if(this.state.isTransitioning=!1,!this.config.loop)return;const t=this.originalItems.length;this.state.currentIndex>=2*t?(this.state.currentIndex=t,this.updateCarousel(!1)):this.state.currentIndex<t&&(this.state.currentIndex=t+this.state.currentIndex%t,this.updateCarousel(!1))}dragStart(t){this.state.isTransitioning||(this.state.isDragging=!0,this.state.startPos=t.type.includes("mouse")?t.pageX:t.touches[0].clientX,this.track.style.transition="none",this.stopAutoPlay())}dragEnd(){if(!this.state.isDragging)return;this.state.isDragging=!1;const t=this.state.currentTranslate-this.state.prevTranslate,e=this.carousel.offsetWidth/10;t<-e?this.next():t>e?this.prev():this.updateCarousel(),this.handleAutoPlay()}dragAction(t){if(!this.state.isDragging)return;const e=(t.type.includes("mouse")?t.pageX:t.touches[0].clientX)-this.state.startPos;Math.abs(e)>5&&t.cancelable&&t.preventDefault(),this.state.currentTranslate=this.state.prevTranslate+e,this.state.animationID||(this.state.animationID=requestAnimationFrame(()=>{this.track.style.transform=`translate3d(${this.state.currentTranslate}px, 0, 0)`,this.updateUI(),this.state.animationID=null}))}next(){this.state.isTransitioning||!this.config.loop&&this.state.currentIndex>=this.items.length-this.currentSlidesToShow||(this.state.isTransitioning=!0,this.state.currentIndex++,this.updateCarousel())}prev(){this.state.isTransitioning||!this.config.loop&&this.state.currentIndex<=0||(this.state.isTransitioning=!0,this.state.currentIndex--,this.updateCarousel())}goTo(t){this.state.isTransitioning||(this.state.isTransitioning=!0,this.state.currentIndex=t,this.updateCarousel())}updateCarousel(t=!0){const e=this.carousel.offsetWidth,s=e/this.currentSlidesToShow;let i=-this.state.currentIndex*s;this.config.centerMode&&(i+=e/2-s/2),this.track.style.transition=t?"transform 0.6s cubic-bezier(0.23, 1, 0.32, 1)":"none",this.track.style.transform=`translate3d(${i.toFixed(4)}px, 0, 0)`,this.state.currentTranslate=i,this.state.prevTranslate=i,requestAnimationFrame(()=>{this.updateUI(),this.updateHeight()})}updateHeight(){const t=this.carousel.querySelector(".ab-carousel-container");if(!t)return;const e=this.state.currentIndex,s=e+Math.ceil(this.currentSlidesToShow);let i=0;for(let t=e;t<s;t++)if(this.items[t]){const e=this.items[t].firstElementChild?this.items[t].firstElementChild.offsetHeight:this.items[t].offsetHeight;e>i&&(i=e)}i>0&&(t.style.height=`${i}px`)}updateUI(){const t=this.originalItems.length,e=this.config.loop?this.state.currentIndex%t:this.state.currentIndex;this.items.forEach((t,e)=>{t.classList.toggle("active",e===this.state.currentIndex)});const s=this.dotsContainer?.querySelectorAll(".ab-carousel-dot");s?.forEach((t,s)=>t.classList.toggle("active",s===e)),this.config.loop||(this.prevBtn?.classList.toggle("hidden",this.state.currentIndex<=0),this.nextBtn?.classList.toggle("hidden",this.state.currentIndex>=this.items.length-this.currentSlidesToShow))}handleAutoPlay(){this.stopAutoPlay(),this.config.autoPlay&&this.state.isVisible&&(this.state.autoPlayInterval=setInterval(()=>this.next(),this.config.duration))}stopAutoPlay(){this.state.autoPlayInterval&&(clearInterval(this.state.autoPlayInterval),this.state.autoPlayInterval=null)}}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll(".ab-carousel").forEach(t=>new ABCarousel(t))});